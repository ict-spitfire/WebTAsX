<!DOCTYPE html>
<html lang="en">
<head>
	<title>SPITFIRE WebTAsX</title>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script src="js/require.js"></script>

	<!-- Page core -->
	<script src="js/jquery-latest.js"></script>
	<script src="js/bootstrap.min.js"></script>

	<script>

		requirejs.config({
			baseUrl: 'js',
			paths: {
			    jquery : "jquery-latest.min",
				bootstrap: 'bootstrap.min'
			},
			// Dependencies
			shim: {
			    jquery: {
			        exports: "$"
			    },
				bootstrap : ['jquery']
			}
		});

		require(
			['config', 'modules', 'jquery', 'urlencode', 'remove', 'alert', 'dnd', 'once', 'periodically', 'logic'],
			function(foo, modules) {
				init(modules);
			}
		);

		// Keeps the last generated queries
		var query = null;
		
		// Keeps all queries
		// [x][0] The SPARQL query
		// [x][1] Textual description
		// [x][2] Action command, e.g. ON/OFF
		// [x][3] Interval event
		var queries = [];
		var modid = 0;

		function init (modules) {

			// Get the last SPARQL query
			var query1 = localStorage.getItem("query1");
			if(query1 != null) {
				$('#query-text1').val(query1);
			}
			var query2 = localStorage.getItem("query2");
			if(query2 != null) {
				$('#query-text2').val(query2);
			}

			// Get all saves queries to rerun them
			var saved_queries = localStorage.getItem("saved_queries");
			if(saved_queries != null && saved_queries != "null") {
				var queries2 = JSON.parse(saved_queries);
				for(var i =0; i<queries2.length;i++) {	
					var q = queries2[i];
					if(q != null) {
						queries.push(q);
						run_queries_periodically(q[0], q[2], queries.length-1);
					}
				}
				update_storage();
			}

			// Add modules
			addModules([modules]); //weather_module,modul2,modul3

			// Add event listeners
			document.getElementById('query-start').addEventListener('click', query_start, false);
			document.getElementById('query-restart').addEventListener('click', query_start, false);
			document.getElementById('action-start').addEventListener('click', action_start, false);

			$("#saveConfig").click(function() {
				for (var key in config){
					var id = "config-" + key;
					var input = $("#" + id);
					var value = input.val();
					localStorage.setItem(key, value);
				}
				alert("Successful");
			});

			$("#query-result-rules").html(create_info("No result yet."));
			$("#query-result-actors").html(create_info("No result yet."));
		}



		function update_storage() {
			var ul = $("<ul>");
			for(var i = 0; i < queries.length; i++) {
				var q = queries[i];
				if(q == null) continue;

				// Generate LI
				var li = $("<li>");
				var del_img = $("<img style=\"cursor:pointer;\" src=\"img/cancel.png\">");
				var onClick = function(i) {
					return function() {
						if(queries[i] != null) {
							clearTimeout(queries[i][3]);
							//queries.remove(i);
							queries[i] = null;
							localStorage['saved_queries'] = JSON.stringify(queries);
							update_storage();
						}
					}
				};

				del_img.click(onClick(i));
				li.append(del_img);
				li.append(" " + q[1]);
				// Add LI
				ul.append(li);
			}
			$("#storage").html(ul);
		}

		function update(x) {
			/*
			console.log("----------------------------------------------------------------------------------")
			console.log(x);
			console.log("----------------------------------------------------------------------------------")
			console.info("SPARQL rules:");
			var query_rules = generate_sparql($("#rules .query-spo"), $("#no-rule-msg1"));
			console.info("SPARQL actors:");
			var query_actions = generate_sparql($("#actuation .query-spo"), $("#no-rule-msg2"));

			if(query_rules.query.length > 0 && query_actions.query.length > 0) {
				var q = "SELECT * WHERE { " + query_rules.query + " UNION " + query_actions.query + " }";
				localStorage.setItem("query", q);
			}

			// Update the text field
			$("#query-text1").val(q);
			query = [q, query_rules, query_actions];
			*/
		}

		// o[0] what to show
		// o[1] what to map
		// o[2] 
		// o[3] preselected
		// event changeevent
		function generate_select(o, event, str) {
			var select = $('<select></select>');

			for(var j = 0; j<o.length; j++) {
				var option = "<option value=\"" + o[j][1] + "\" ";

				if(typeof(str) == "string" && typeof(o[j][2]) == "string") {
					option += "" + str + "=\"" + o[j][2] + "\" ";			
				}

				if(o[j][3] == true) {
					option += " selected";
				}
				option += ">" + o[j][0] + "</option>";
				select.append(option);
			}
			if(typeof(event) == "function") {
				select.change(event);
			}
			return select;
		}

		function addModules(modules) {
			for(var i = 0; i < modules.length; i++) {
				addModule(modules[i]);
			}
		}

		function addModule(module) {
			modid++;

			var lineid = 0;

			var create = function(s_mapping, s) {

				var spo_id = "spo" + (lineid++);
				var div_spo = $("<div id=\"" + spo_id + "\" class=\"query-spo\"></div>");
				
				createimg = function() {
					return $("<img class=\"dnd\" src=\"img/arrow_in.png\">");
				}

				// SPO-divs
				var div_s = $("<div id=\"s" + lineid + "\" draggable=\"true\" class=\"box\"></div>"); //  style=\"padding:2px; border: 2px solid red;\"
				var div_p = $("<div id=\"p" + lineid + "\" draggable=\"true\" class=\"box\"></div>"); //  style=\"padding:2px; border: 2px solid blue;\"
				var div_o = $("<div id=\"o" + lineid + "\" draggable=\"true\" class=\"box\"></div>"); //  style=\"padding:2px; border: 2px solid green;\"

				var create_dnd = function(div) {
					// By dnd.js file
					div.bind('dragstart', dnd.handleDragStart);
					div.bind('dragend', dnd.handleDragEnd);
					div.bind('dragover', dnd.handleDragOver);
					div.bind('drop', dnd.handleDrop);
				}  

				create_dnd(div_s);
				create_dnd(div_p);
				create_dnd(div_o);

				var div_del = $("<span></span>");
				
				var del_img = $("<img style=\"cursor:pointer;\" src=\"img/cancel.png\">");
				del_img.click(function() { 
					$("#" + spo_id).remove();
					update("del_img.click");
				});
				div_del.append(del_img);

				// Append SPO-divs to main div
				div_spo.append(div_s);
				div_spo.append(div_p);
				div_spo.append(div_o);
				div_spo.append(div_del);

				var s_change = function() {
					var s_text = select_s.find("option:selected").text();

					for(var i = 0; i<s_mapping.length; i++) {
						if(s_mapping[i][0] == s_text) {
							var p_mapping = s_mapping[i][2];

							var p_change = function(e){
								var text = select_p.find("option:selected").text();
								var select_o = null;
								for(var i = 0; i<p_mapping.length; i++) {
									if(p_mapping[i][0] == text) {
										var o_change = function(e){
											update("o_change");
										};
										var o_mapping = p_mapping[i][2];

										if(typeof(o_mapping) == "undefined") {
											select_o = generate_select([["?","?"]], o_change);
										} else {
											select_o = generate_select(o_mapping, o_change, "actors");
										}
									}
								}
								div_o.empty();
								div_o.append(select_o);
								update("p_change");
							};
							var select_p = generate_select(p_mapping, p_change, "actors");
							div_p.empty();
							div_p.append(select_p);

							// Empty select for O
							var select_o = $('<select class="o"></select>');
							select_o.append("<option value=\"?\">?</option>");

							select_p.trigger('change');
						}
					}
					update("s_change");
				}

				// Select for S
				var select_s = generate_select(mapping, s_change, "actors");
				div_s.append(select_s);
				select_s.trigger('change');
				return div_spo;
			}

			var mapping = module.mapping;

			// Add new menu
			var li = $('<li><a href="#tab' + modid + '" data-toggle="tab">' + module.title + '</a></li>');
			$("#tab-tabs li:last").after(li);

			// Add new content pane
			var div = $("<div class=\"tab-pane\" id=\"tab" + modid +  "\" style=\"min-height:250px;\"></div>");
			$("#tab-content").append(div);

			// Set to active, if configured
			if(module.isActive) {
				div.addClass("active");
				li.addClass("active");
			}

			// #################################################################
			// RULES
			// #################################################################

			outputRules = $("<span id=\"rules\"></span>");
			ruleSelection = $("<div></div>");

			var rules = new Logic(outputRules);
			rules.onsparql = generateSPO;
			rules.init();
			div.append("<h4>Rules</h4>");
			div.append(outputRules);
			div.append(ruleSelection);

			function generateSPO() {
				var local = $("<span class=\"spo\"></span>");
				local.append("<br>");
				// Add [+]-Button to the content pane
				var input = $("<input class=\"btn\" type=\"button\" value=\"+\">");
				local.append(input);

				input.click(function(e) {
					div_rules.append(create(module.mapping, module.s));
					info_msg_rules.hide();
					update("input.click");
				});

				var name = $("<input style=\"margin-bottom:0px\" data-name=\"\" type=\"text\">");
				local.append("&nbsp;", name);

				// Create a div, to keep all rules and add it to the content pane
				var div_rules = $("<div class=\"rules\" style=\"margin-top:5px;\"></div>");
				var info_msg_rules = $(create_info("No selection rule yet. Click the [+] button.", "no-rule-msg1", false)); // Empty message
				div_rules.append(info_msg_rules);
				local.append(div_rules);		
				ruleSelection.append(local);
				return local;
			}

			div.append("<h4>Actuators</h4>");

			var input2 = $("<input class=\"btn\" type=\"button\" value=\"+\">");
			input2.click(function(e) {
				div_actuation.append(create(module.mapping, module.s));
				info_msg_actuation.hide();
				update("nput2.click");
			});
			div.append(input2);

			var div_actuation = $("<div id=\"actuation\" style=\"margin-top:5px;\"></div>");
			var info_msg_actuation = $(create_info("No actuation rules yet. Click the [+] button.", "no-rule-msg2", false)); // Empty message
			div_actuation.append(info_msg_actuation);
			div.append(div_actuation);		


			// Create a div to keep the save stuff and add it to the content pane
			var form = $('<form class="form-horizontal">');
			div.append(form);

			form.append("<h4>Action</h4>");
			var div_action = $("<div style=\"margin-top:5px;\" class=\"control-group\"></div>"); // <label class=\"control-label\">Action:</label>
			var div_action_controls = $('<div class="controls"></div>');
			var select_action = $("<select id=\"action-value\"></select>");
			select_action.append($("<option value=\"on\">on</option>"));
			select_action.append($("<option value=\"off\">off</option>"));
			select_action.append($("<option value=\"toggle\">toggle</option>"));
			form.append(div_action)
			div_action.append(div_action_controls);
			div_action_controls.append(select_action);

			form.append("<h4>Task</h4>");
			
			var div_rule = $("<div style=\"margin-top:5px;\" class=\"control-group\"><label class=\"control-label\">Task Name:</label></div>");
			var div_rule_controls = $('<div class="controls"></div>');
			form.append(div_rule)
			div_rule.append(div_rule_controls);
			var input_rule_text = $("<input type=\"text\" placeholder=\"Task name...\" class=\"span6\">");
			div_rule_controls.append(input_rule_text);

			var div_button = $("<div style=\"margin-top:5px;\" class=\"control-group\"></div>");
			var div_button_controls = $('<div class="controls"></div>');
			var input_button_text = $("<button class=\"btn\" type=\"button\">Start task</button>");
			var input_button_once =    $("<button class=\"btn\" type=\"button\">Run query once</button>");

			function prepare_queries () {
					
				try{
					var prefixes = "";
					for(var i = 0; i<module.prefixes.length; i++) {
						prefixes += "PREFIX " + module.prefixes[i][0] + ":<" + module.prefixes[i][1] + ">\n";
					}
					var q1 = prefixes + "\n" + rules.query();

					console.info("SPARQL rules:");
					console.log(q1);

					var query_actions = generate_sparql($("#actuation .query-spo"));
					if(typeof(query_actions) == "undefined") {
						throw ("Actuators have no triples!")
					} else if(typeof(query_actions) == "object" && !query_actions.hasActuator) {
						throw ("Actuators triples define no actuators!")						
					} else {
						var q2 = prefixes + "\n" + "SELECT " + implode(" ", query_actions.selections) + " WHERE {\n " + query_actions.query + " }\n";
						console.info("SPARQL actors:");
						console.log(q2);
					}

					localStorage.setItem("query1", q1);
					$("#query-text1").val(q1);

					localStorage.setItem("query2", q2);
					$("#query-text2").val(q2);

				} catch(e) {
					alert(e);
				}
				
			};

			input_button_once.click(function(e) {
				 prepare_queries();
				//update("input_button_once.click");
				// XXX
				//run_queries_once(query, requestHandlerOnce.success_once, requestHandlerOnce.error_once, requestHandlerOnce.async_once);
			});

			form.append(div_button)
			div_button.append(div_button_controls);
			div_button_controls.append(input_button_text);
			//div_button_controls.append(" ");
			//div_button_controls.append(input_button_once);

			//var input_save = $();

			function query_save() {
				 prepare_queries();
				/*
				// XXX
				if(query == null) {
					alert("You need at least one rule to run the query.");
					return;
				}
				if(input_rule_text.val().length == 0) {
					alert("You need a task name to run the query.");
					return;
				}

				$("#tab-storage-link").click();

				// XXX
				var idx = queries.push([query, input_rule_text.val(), select_action.val(), null]);
				localStorage['saved_queries'] = JSON.stringify(queries);
				update_storage();
				// XXX
				run_queries_periodically(query, select_action.val(), idx-1);
				*/
			}
			input_button_text.click(query_save);

		}

		var valCnt = 0;
		function generate_sparql(spo) {

			var q = null;
			var result = new Object();
			if(spo.length == 0) {
				return;
			} else {

				var ids = [];
				
				q = "";
				var actors = []; 	
				var variables = [];
				for(var i = 0; i < spo.length; i++) {
					var children = spo[i].childNodes;

                    var tmp = "";

					for(var j = 0; j < children.length; j++) {
						var c = children[j];
						var v = $(c).attr("var");
						var e = $(c.firstChild);
						// Skip the dnd-image
						if(e.is("img")) break;
						var option = e.find("option:selected");
						var actor = option.attr("actors");
						if(typeof(actor) == "string" && actor != "") {
							actors.push(actor);
						}

						var val = e.val();

						var cont = false;

						if(typeof(v) == "string" && val.indexOf("{val}") >= 0) {
							if(val.indexOf("{val}") >= 0) {
								val = val.replace(new RegExp("{val}", "g"), "?" + v);
							}
                            tmp += val;
						} else if (val == "?") {
							var varx = "?val" + (++valCnt);
							variables.push(varx);
							tmp += varx;
						} else if (typeof(v) != "string" && val.indexOf("{val}") >= 0) {
							var varx = "?val" + (++valCnt);
							variables.push(varx);
							if(val.indexOf("{val}") >= 0) {
								val = val.replace(new RegExp("{val}", "g"), varx);
							}
                            tmp += val;
						} else {
                            tmp += val;
						}
						
						tmp += " ";

					}

                    /*
                     * http://coding.pressbin.com/16/Javascript-equivalent-of-PHPs-pregmatchall
                     */
                    function preg_match_all(regex, haystack) {
                        var globalRegex = new RegExp(regex, 'g');
                        var globalMatch = haystack.match(globalRegex);
                        matchArray = new Array();
						if(globalMatch != null) {
		                    for(var gmi = 0; gmi < globalMatch.length; gmi++) {
		                        nonGlobalRegex = new RegExp(regex);
		                        nonGlobalMatch = globalMatch[gmi].match(nonGlobalRegex);
		                        matchArray.push(nonGlobalMatch[1]);
		                    }
						}
                        return matchArray;
                    }

                    var regex = '{([^"]*?)}';
                    var matches = preg_match_all(regex, tmp);

                    /*
                     * http://stackoverflow.com/a/15868720/605890
                     */
                    var uniq = matches.reduce(function(a,b){
                        if (a.indexOf(b) < 0 ) a.push(b);
                        return a;
                    },[]);

                    // Replace the vars
                    for(var k = 0; k<uniq.length; k++) {
                        var varname = uniq[k];
                        var varx = "?" + varname + (++valCnt);
						variables.push(varx);
                        tmp = tmp.replace(new RegExp("{" + varname + "}", "g"), varx);

                        // Check, if any actor is a variable as well
                        if(actors.length > 0) {
                            for(var aidx = 0; aidx < actors.length; aidx++) {
                                var actor = actors[aidx];
                                if(actor == "{" + varname + "}") {
                                    actors[aidx] = varx;
                                }
                            }
                        }
                    }

                    // Here, one line is complete
                    if(tmp.indexOf("<s>") >= 0) {
                        var varx = "?val" + (++valCnt);
						variables.push(varx);
                        tmp = tmp.replace(new RegExp("<s>", "g"), "" + varx + " ");
                    }

                    q += "\t" + tmp + " . \n";
				}

				//q = "{\n" + q + "}";
				
				if(actors.length == 0) {
					result.selections = "*";
					result.hasActuator = false;
					console.log("Query does not contain any actor!");
				} else {
					result.hasActuator = true;
					result.selections = actors.join(" ");
				}

				result.variables = variables;
				result.query = q;
				//console.log(q);
			}

			return result;
		}

		var eval = [];


		function run_queries_periodically(queries2, action, index) {

			//eval[index] = [];
			//eval.push

			var redoTimeout = 2000;

			var start = 0;
			function succ1(res) {
				if(typeof(res.res) == "string") {

					/*
					success_periodically(res, action);

					var elapsed = new Date().getTime() - start;
					console.log("elapsed: " + elapsed);

					var rest = redoTimeout - elapsed;
					console.log("rest: " + rest);

					if(rest <= 0) {
						rest = 0;
						console.log("Redo queries NOW!");
					} else {
						console.log("Redo queries in " + rest + "ms");
					}

					// Not stpped yet
					if(queries[index] != null) {
						queries[index][3] = setTimeout(funPerInterval1, rest);
					}
					*/
				}
			}

			var funPerInterval1 = function () {
				start = new Date().getTime();
				run_queries_once(queries2, succ1, error_periodically, function() {})
			}

			// Initial...
			queries[index][3] = setTimeout(funPerInterval1, 0);
		}

		function doAction(url, action) {
			url = config['sparqlEndpoint'] + "/?uri=" + url;
			console.log("RUN ACTION ON " + url + " :: " + action);
			
			var xhr = new XMLHttpRequest();
			xhr.open('POST', url, true);
			xhr.responsetype = "text";

			xhr.onload = function(e) {

				// ##############################################
				// EVALUATION
				// ##############################################

				var key = "action-" + url + "-" + action;
				if (this.readyState == 4 && this.status == 200) {
					var elapsed = new Date().getTime() - start;
					var e = localStorage.getItem("eval-action");
					var result = new Object();
					if(e != null) {
						result = JSON.parse(e);	
					}
					if(typeof(result[key]) == "undefined") {
						result[key] = [];
					}
					result[key].push(elapsed);
					localStorage.setItem("eval-action", JSON.stringify(result));
				}

				// ##############################################
				// EVALUATION
				// ##############################################

				lastStatus = this.status;
				// 200 ok
				// 201 created
				// 204 non content
				if (!(this.readyState == 4 && (this.status == 200 || this.status == 201 || this.status == 204))) {
					console.log(url + " + " + action + " ERROR - STATUS: " + this.status);
				}
			}
			var start = new Date().getTime();
			xhr.send(action);
		}

		// Run action on url
		function action_request(url, action) {
			if(action == null) return;
			var query = "SELECT DISTINCT ?o WHERE { <" + url + "> <http://spitfire-project.eu/ontology/ns/value> ?o }";

			var onsuccess = function(res) {

				var dom = new DOMParser().parseFromString(res,'text/xml');
				var variables = dom.getElementsByTagName("literal");
				for(var i = 0; i < variables.length; i++) {
					var variable = variables[i];
					var value = variable.childNodes[0].data;

					if(parseInt(value) == 1 && action == "toggle") {
						console.log("TOGGLE TO OFF!");
						doAction(url, "off");
					} else if(parseInt(value) == 0 && action == "toggle" ) {
						console.log("TOGGLE TO ON!");
						doAction(url, "on");
					} else if(parseInt(value) == 1 && action == "off" || parseInt(value) == 0 && action == "on" ) {
						doAction(url, action);
					} 
				}
			}

			var sparql_url = config['sparqlEndpoint'];
			execute_sparql_query(sparql_url, query, onsuccess);

		}

		// Run action for selected actors from Result
		function action_start() {
			var e = $("td.marked");
			for (var i = 0, i; i < e.length; i++) {
				var child = e[i].firstChild;
				action_request(child.data, $('#action-value').val());
			}
		}

		// Run querys from Query-Textbox
		function query_start() {
			var q1 = new Object();
			q1.query = $("#query-text1").val();

			var q2 = new Object();
			q2.query = $("#query-text2").val();
			q2.hasActuator = true;

			run_queries_once([q1,q2], requestHandlerOnce.success_once, requestHandlerOnce.error_once, requestHandlerOnce.async_once);
		}
 
		// Run a query once
		function run_queries_once(queries, onsuccess, onerror, onasync, filter) {

			if(queries[0].query == null) {
				alert("You need at least one selection rule to run the query.");
				return;				
			} else if(queries[1].query == null) {
				alert("You need at least one actuation rule to run the query.");
				return;				
			} else if(!queries[1].hasActuator) {
				alert("You need to define at least one actuator.");
				return;				
			}

			var succData = new Object();
			var url = config['sparqlEndpoint'];

			if(queries[0].query.length > 0 && queries[1].query.length > 0) {
				var q = "SELECT * WHERE { " + queries[0].query + " UNION " + queries[1].query + " }";
				localStorage.setItem("query", q);
			}
			
			var onsuccessQ = function (res) {
				succData.res = res;
				onsuccess(succData, queries);
			}
			
			execute_sparql_query(url, q, onsuccessQ);

			if(typeof(onasync) == "function") {
				onasync();
			}
		}

		function execute_sparql_query(url, query, onsuccess) {

			// #################################################################
			// SSP with Apache Jena/SDB RESTful interface
			// POST query on /sparql
			// #################################################################

			var xhr = new XMLHttpRequest();
			xhr.responsetype = "text";
			xhr.open('POST', url + "/sparql", true);
			xhr.onload = function(e) {
				// The response type is "SPARQL Query Results XML Format (Second Edition)"
				// http://www.w3.org/TR/rdf-sparql-XMLres/
				if (this.readyState == 4 && this.status == 200) {

					// ##############################################
					// EVALUATION
					// ##############################################

					var elapsed = new Date().getTime() - start;
					console.log(query + ":" + elapsed);
					var e = localStorage.getItem("eval-queries");
					var result = new Object();
					if(e != null) {
						result = JSON.parse(e);	
					}
					if(typeof(result[query]) == "undefined") {
						result[query] = [];
					}
					result[query].push(elapsed);
					localStorage.setItem("eval-queries", JSON.stringify(result));

					// ##############################################
					// EVALUATION
					// ##############################################


					if(typeof(onsuccess) == "function") {
						onsuccess(this.response);
					}
				} else if (this.readyState == 4){
					console.log("Some error...");
				}
			}

			var start = new Date().getTime();
			xhr.send(query);

			// #################################################################
			// Sesame RESTful interface
			// GET with query in query param
			// #################################################################
			/*
			var encoded = urlencode(query);
			var path = url + "?query=" + encoded;

			var xhr = new XMLHttpRequest();
			xhr.responsetype = "text";
			xhr.open('GET', path, true);
			xhr.setRequestHeader("Accept", "application/xml");
			xhr.onload = function(e) {

				// The result type is "SPARQL Query Results XML Format (Second Edition)"
				// http://www.w3.org/TR/rdf-sparql-XMLres/
				if (this.readyState == 4 && this.status == 200) {
					if(typeof(onsuccess) == "function") {
						onsuccess(this.response);
					}
				} else if (this.readyState == 4){
					console.log("Some error...");
				}
				
//				TODO: Error handling
//				else if (this.status == 504) {
//					if(typeof(onerror) == "function") {
//						onerror("CoAP timeout.");
//					}
//				} else {
//					if(typeof(onerror) == "function") {
//						onerror("HTTP-Status: " + this.status);
//					}
//				} 
			}
			xhr.send(null);
			// #################################################################
			*/
		}
	</script>
</head>
<body>

	<div class="container">
			<h1>SPITFIRE WebTAsX</h1>
			<ul class="nav nav-tabs" id="tab-tabs">
				<!--
				<li><a href="#tab-import" data-toggle="tab">Module Import</a></li>
				<li><a href="#tab-config" data-toggle="tab">Config</a></grepli>
				<li><a id="tab-storage-link" href="#tab-storage" data-toggle="tab">Storage</a></li>
				<li><a id="tab-result-link" href="#tab-result" data-toggle="tab">Result</a></li>
				-->
				<li><a href="#tab-query" data-toggle="tab">Query-Textbox</a></li>
			</ul>
			<div class="tab-content" id="tab-content">
				<div class="tab-pane" id="tab-query">
					<h3>Query</h3>
					<h4>Rules Query</h4>
					<textarea id="query-text1" style="width:97%;height:250px;"></textarea><br>
					<h4>Actors Query</h4>
					<textarea id="query-text2" style="width:97%;height:250px;"></textarea><br>
					<p><input class="btn" type="button" id="query-start" value="Run Query"></p>
				</div>
				<div class="tab-pane" id="tab-storage">
					<h3>Storage</h3>
					<p id="storage">...</p>
				</div>
				<div class="tab-pane" id="tab-config">
					<h3>Configuration</h3>
					<form class="form-horizontal">
					  <div class="control-group">
						<label for="config-lightThreshold" class="control-label">Light threshold:</label>
						<div class="controls">
						  <input type="text" placeholder="Threshold" id="config-lightThreshold">
						</div>
					  </div>
					  <div class="control-group">
						<label for="config-sparqlEndpoint" class="control-label">Sparql endpoint:</label>
						<div class="controls">
						  <input type="text" placeholder="http://..." id="config-sparqlEndpoint">
						</div>
					  </div>
					  <div class="control-group">
						<div class="controls">
						  <input type="input" id="saveConfig" class="btn" value="Save">
						</div>
					  </div>
					</form>					
				</div>
				<div class="tab-pane" id="tab-result">
					<h3>Result</h3>
					<p><input class="btn" type="button" id="query-restart" value="Rerun Query"></p>
					<h4>Result rules</h4>
					<p id="query-result-rules"></p>

					<h4>Result actors</h4>
					<p id="query-result-actors"></p>
					<h3>Actuation</h3>
					<p>
						<select id="action-value">
							<option value="on">on</option>
							<option value="off">off</option>
							<option value="toggle">toggle</option>
						</select>
						<br>
						<button class="btn" type="button" id="action-start">Run Actuation</button>
					</p>
				</div>
			</div>
	</div>

</body>
</html>
